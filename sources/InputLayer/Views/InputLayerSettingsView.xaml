<UserControl x:Class="InputLayer.Views.InputLayerSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ap="clr-namespace:InputLayer.AttachedProperties"
             xmlns:controls="clr-namespace:InputLayer.Controls"
             xmlns:converters="clr-namespace:InputLayer.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:helpers="clr-namespace:InputLayer.Helpers"
             xmlns:infrastructures="clr-namespace:InputLayer.Infrastructures"
             xmlns:infrastructuresCommon="clr-namespace:InputLayer.Common.Infrastructures;assembly=InputLayer.Common"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:me="clr-namespace:InputLayer.MarkupExtensions"
             xmlns:models="clr-namespace:InputLayer.Models"
             xmlns:viewModels="clr-namespace:InputLayer.ViewModels"
             x:Name="InputLayerSettingsViewControl"
             d:DataContext="{d:DesignInstance viewModels:InputLayerSettingsViewModel}"
             mc:Ignorable="d">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="150" />
        </Grid.RowDefinitions>

        <HeaderedContentControl Grid.Row="0" Header="{me:LocalizationBinding Key=InputLayer.DisplayMode}">
            <controls:StackPanelWithGap Gap="10" Orientation="Horizontal">
                <controls:StackPanelWithGap.Resources>
                    <Style BasedOn="{StaticResource {x:Type ToggleButton}}" TargetType="{x:Type ToggleButton}">
                        <Setter Property="Width" Value="150" />
                    </Style>
                </controls:StackPanelWithGap.Resources>

                <ToggleButton Command="{Binding SetControllerInputDisplayModeCommand}"
                              CommandParameter="{x:Static infrastructuresCommon:ControllerInputDisplayMode.XBOX}"
                              Content="XBOX"
                              IsChecked="{Binding Settings.DisplayMode,
                                                  Mode=OneWay,
                                                  Converter={converters:EqualToBooleanConverter},
                                                  ConverterParameter={x:Static infrastructuresCommon:ControllerInputDisplayMode.XBOX}}" />

                <ToggleButton Command="{Binding SetControllerInputDisplayModeCommand}"
                              CommandParameter="{x:Static infrastructuresCommon:ControllerInputDisplayMode.PS}"
                              Content="PS"
                              IsChecked="{Binding Settings.DisplayMode,
                                                  Mode=OneWay,
                                                  Converter={converters:EqualToBooleanConverter},
                                                  ConverterParameter={x:Static infrastructuresCommon:ControllerInputDisplayMode.PS}}" />

                <ToggleButton Command="{Binding SetControllerInputDisplayModeCommand}"
                              CommandParameter="{x:Static infrastructuresCommon:ControllerInputDisplayMode.NintendoSwitch}"
                              Content="Nintendo Switch"
                              IsChecked="{Binding Settings.DisplayMode,
                                                  Mode=OneWay,
                                                  Converter={converters:EqualToBooleanConverter},
                                                  ConverterParameter={x:Static infrastructuresCommon:ControllerInputDisplayMode.NintendoSwitch}}" />
            </controls:StackPanelWithGap>
        </HeaderedContentControl>

        <controls:StackPanelWithGap Grid.Row="1"
                                    Margin="0,10,0,0"
                                    Gap="10">

            <HeaderedContentControl Header="{me:LocalizationBinding Key=InputLayer.SelectButton}">
                <ComboBox ItemsSource="{Binding Source={x:Static helpers:ControllerButtonHelper.MainButtons}}" SelectedValue="{Binding Settings.MainButton, Mode=TwoWay}">

                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type infrastructuresCommon:ControllerInput}">
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding Converter="{converters:ControllerButtonToStringConverter}">
                                        <Binding />
                                        <Binding ElementName="InputLayerSettingsViewControl" Path="DataContext.Settings.DisplayMode" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>

                </ComboBox>
            </HeaderedContentControl>

            <TextBlock FontSize="{DynamicResource FontSizeSmall}"
                       Foreground="{DynamicResource TextBrushDarker}"
                       Text="{me:LocalizationBinding Key=InputLayer.GuideWarning}" />

        </controls:StackPanelWithGap>

        <GroupBox Grid.Row="2"
                  Margin="0,15,0,0"
                  Header="{me:LocalizationBinding Key=InputLayer.Actions.Title}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Margin="0,0,0,15"
                           FontSize="12"
                           Foreground="{DynamicResource TextBrushDarker}"
                           TextWrapping="Wrap">
                    <Run Text="{me:LocalizationBinding Key=InputLayer.Actions.Hint}" />
                    <LineBreak />
                    <Run Text="{me:LocalizationBinding Key=InputLayer.Actions.ItemsHint}" />
                </TextBlock>

                <TabControl Grid.Row="1"
                            ItemsSource="{Binding Converter={converters:EnumToSourceConverter},
                                                  Source={x:Type infrastructures:ActionTab}}"
                            SelectedItem="{Binding ActionTab}">
                    <TabControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type infrastructures:ActionTab}">
                            <TextBlock Text="{me:LocalizationBinding Path=., StringFormat={}InputLayer.Tabs.{0}}" />
                        </DataTemplate>
                    </TabControl.ItemTemplate>
                    <TabControl.ContentTemplate>
                        <DataTemplate DataType="{x:Type infrastructures:ActionTab}" />
                    </TabControl.ContentTemplate>
                </TabControl>

                <Grid Grid.Row="2" Margin="0,15,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <ScrollViewer Grid.Row="0"
                                  HorizontalScrollBarVisibility="Hidden"
                                  VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="ControllerActions" ItemsSource="{Binding SelectedControllerActions}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:ControllerAction}">

                                    <controls:GridWithGap x:Name="ControllerActionRoot"
                                                          Margin="0,0,0,10"
                                                          ColumnGap="10"
                                                          IsEnabled="{Binding IsPredefined,
                                                                              Converter={converters:InvertBooleanConverter}}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="300" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <controls:GridWithGap ColumnGap="10">

                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <controls:PlaceholderControl Grid.Column="0"
                                                                         IsEmpty="{Binding ElementName=ButtonComboBox,
                                                                                           Path=SelectedItem,
                                                                                           Converter={converters:NullToBooleanConverter}}"
                                                                         Placeholder="{me:LocalizationBinding Key=InputLayer.ButtonPlaceholder}">

                                                <ComboBox x:Name="ButtonComboBox"
                                                          MinHeight="28"
                                                          VerticalAlignment="Top"
                                                          ap:ComboBoxRefreshBindingOnLoadBehavior.RefreshBindingOnLoad="True"
                                                          SelectedValue="{Binding Button,
                                                                                  Mode=TwoWay}">
                                                    <ComboBox.ItemsSource>
                                                        <MultiBinding Converter="{converters:AvailableControllerButtonsConverter}">
                                                            <Binding Source="{x:Static helpers:ControllerButtonHelper.All}" />
                                                            <Binding ElementName="InputLayerSettingsViewControl" Path="DataContext.Settings.MainButton" />
                                                            <Binding ElementName="ControllerActions" />
                                                            <Binding RelativeSource="{RelativeSource Self}" />
                                                            <Binding ElementName="InputLayerSettingsViewControl" Path="DataContext.SelectedControllerActions" />
                                                            <Binding Path="IsDropDownOpen" RelativeSource="{RelativeSource Self}" />
                                                        </MultiBinding>
                                                    </ComboBox.ItemsSource>

                                                    <ComboBox.ItemTemplate>
                                                        <DataTemplate DataType="{x:Type infrastructuresCommon:ControllerInput}">
                                                            <TextBlock>
                                                                <TextBlock.Text>
                                                                    <MultiBinding Converter="{converters:ControllerButtonsToStringConverter}">
                                                                        <Binding ElementName="InputLayerSettingsViewControl" Path="DataContext.Settings.MainButton" />
                                                                        <Binding />
                                                                        <Binding ElementName="InputLayerSettingsViewControl" Path="DataContext.Settings.DisplayMode" />
                                                                    </MultiBinding>
                                                                </TextBlock.Text>
                                                            </TextBlock>
                                                        </DataTemplate>
                                                    </ComboBox.ItemTemplate>

                                                </ComboBox>

                                            </controls:PlaceholderControl>

                                            <controls:StackPanelWithGap Grid.Column="1"
                                                                        MinHeight="28"
                                                                        VerticalAlignment="Top"
                                                                        Gap="10"
                                                                        Orientation="Horizontal">
                                                <Button Command="{Binding DataContext.RemoveControllerActionCommand,
                                                                          ElementName=InputLayerSettingsViewControl}"
                                                        CommandParameter="{Binding}"
                                                        Cursor="Hand"
                                                        ToolTip="{me:LocalizationBinding Key=InputLayer.Actions.Remove.Hint}">

                                                    <Path Width="16"
                                                          Height="16"
                                                          Data="{DynamicResource TrashGeometry}"
                                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button},
                                                                         Path=Foreground}"
                                                          Stretch="Uniform" />

                                                </Button>
                                            </controls:StackPanelWithGap>

                                        </controls:GridWithGap>

                                        <ScrollViewer Grid.Column="1"
                                                      HorizontalScrollBarVisibility="Hidden"
                                                      VerticalScrollBarVisibility="Auto">
                                            <ItemsControl ItemsSource="{Binding Actions}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <controls:StackPanelWithGap Gap="10" Orientation="Vertical" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate DataType="{x:Type models:ControllerActionItem}">

                                                        <controls:GridWithGap ColumnGap="10">

                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="200" />
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <ComboBox Grid.Column="0"
                                                                      MinHeight="28"
                                                                      VerticalAlignment="Top"
                                                                      ItemsSource="{Binding Source={x:Type infrastructuresCommon:ActionType},
                                                                                            Converter={converters:EnumToSourceConverter}}"
                                                                      SelectedValue="{Binding ActionType,
                                                                                              Mode=TwoWay}">

                                                                <ComboBox.ItemTemplate>
                                                                    <DataTemplate DataType="{x:Type infrastructuresCommon:ActionType}">
                                                                        <TextBlock Text="{me:LocalizationBinding Path=., StringFormat={}InputLayer.{0}Action.Name}" ToolTip="{me:LocalizationBinding Path=., StringFormat={}InputLayer.{0}Action.Description}" />

                                                                    </DataTemplate>
                                                                </ComboBox.ItemTemplate>

                                                            </ComboBox>

                                                            <ContentControl Grid.Column="1" Content="{Binding Action}" />

                                                            <controls:StackPanelWithGap Grid.Column="2"
                                                                                        MinHeight="28"
                                                                                        VerticalAlignment="Top"
                                                                                        Gap="10"
                                                                                        Orientation="Horizontal">

                                                                <Button Command="{Binding DataContext.AddControllerActionItemCommand,
                                                                                          ElementName=ControllerActionRoot}"
                                                                        CommandParameter="{Binding}"
                                                                        Cursor="Hand"
                                                                        ToolTip="{me:LocalizationBinding Key=InputLayer.Actions.AddAction.ItemHint}">

                                                                    <Path Width="16"
                                                                          Height="16"
                                                                          Data="{DynamicResource AddGeometry}"
                                                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button},
                                                                                         Path=Foreground}"
                                                                          Stretch="Uniform" />

                                                                </Button>

                                                                <Button Command="{Binding DataContext.RemoveControllerActionItemCommand,
                                                                                          ElementName=ControllerActionRoot}"
                                                                        CommandParameter="{Binding}"
                                                                        Cursor="Hand"
                                                                        ToolTip="{me:LocalizationBinding Key=InputLayer.Actions.RemoveAction.ItemHint}">

                                                                    <Path Width="16"
                                                                          Height="16"
                                                                          Data="{DynamicResource TrashGeometry}"
                                                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button},
                                                                                         Path=Foreground}"
                                                                          Stretch="Uniform" />

                                                                </Button>

                                                                <Button Command="{Binding DataContext.UpControllerActionItemCommand,
                                                                                          ElementName=ControllerActionRoot}"
                                                                        CommandParameter="{Binding}"
                                                                        Cursor="Hand"
                                                                        ToolTip="{me:LocalizationBinding Key=InputLayer.Actions.UpAction.ItemHint}">

                                                                    <Path Width="16"
                                                                          Height="16"
                                                                          Data="{DynamicResource UpGeometry}"
                                                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button},
                                                                                         Path=Foreground}"
                                                                          Stretch="Uniform" />

                                                                </Button>

                                                                <Button Command="{Binding DataContext.DownControllerActionItemCommand,
                                                                                          ElementName=ControllerActionRoot}"
                                                                        CommandParameter="{Binding}"
                                                                        Cursor="Hand"
                                                                        ToolTip="{me:LocalizationBinding Key=InputLayer.Actions.DownAction.ItemHint}">

                                                                    <Path Width="16"
                                                                          Height="16"
                                                                          Data="{DynamicResource DownGeometry}"
                                                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button},
                                                                                         Path=Foreground}"
                                                                          Stretch="Uniform" />

                                                                </Button>

                                                            </controls:StackPanelWithGap>

                                                        </controls:GridWithGap>

                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                    </controls:GridWithGap>

                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <StackPanel Grid.Row="1"
                                Margin="0,15,0,0"
                                HorizontalAlignment="Right"
                                Orientation="Horizontal">
                        <Button Command="{Binding AddControllerActionCommand}" Cursor="Hand">
                            <controls:GridWithGap ColumnGap="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Path Grid.Column="0"
                                      Width="16"
                                      Height="16"
                                      Data="{DynamicResource AddGeometry}"
                                      Fill="{Binding RelativeSource={RelativeSource AncestorType=Button},
                                                     Path=Foreground}"
                                      Stretch="Uniform" />

                                <TextBlock Grid.Column="1" Text="{me:LocalizationBinding Key=InputLayer.Actions.Add}" />
                            </controls:GridWithGap>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </GroupBox>

        <GroupBox Grid.Row="3"
                  Margin="0,15,0,0"
                  Header="{me:LocalizationBinding Key=InputLayer.Log.Title}">
            <ListBox Padding="5"
                     ItemsSource="{Binding ButtonLogs}"
                     ScrollViewer.VerticalScrollBarVisibility="Auto">
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type infrastructuresCommon:ControllerInput}">
                        <TextBlock>
                            <Run Foreground="{DynamicResource TextBrushDarker}" Text="{me:LocalizationBinding Key=InputLayer.Log.ButtonPressed}" />
                            <Run>
                                <Run.Text>
                                    <MultiBinding Converter="{converters:ControllerButtonToStringConverter}">
                                        <Binding Path="." />
                                        <Binding ElementName="InputLayerSettingsViewControl" Path="DataContext.Settings.DisplayMode" />
                                    </MultiBinding>
                                </Run.Text>
                            </Run>
                        </TextBlock>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </GroupBox>
    </Grid>
</UserControl>